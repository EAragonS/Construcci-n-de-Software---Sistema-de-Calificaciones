name: SonarCloud Analysis

on:
  push:
    branches:
      - main  # O cualquier rama en la que quieras ejecutar el análisis
  pull_request:
    branches:
      - main  # O cualquier rama de destino de tus pull requests

jobs:
  sonarcloud:
    runs-on: ubuntu-latest

    steps:
      # Paso 1: Clonamos el código
      - name: Checkout code
        uses: actions/checkout@v3

      # Paso 2: Configuramos SonarCloud
      - name: Set up SonarCloud
        uses: sonarsource/sonarcloud-github-action@v2
        with:
          sonar-token: ${{ secrets.SONAR_TOKEN }}  # SonarCloud Token (configurado en Secrets)

      # Paso 3: (Opcional) Instalar Ant, solo si no está instalado
      - name: Install Ant
        run: |
          sudo apt-get install ant  # Instalamos Ant si no está presente
        if: ${{ runner.os == 'Ubuntu' }}  # Solo en Ubuntu si es necesario

      # Paso 4: Ejecutar la construcción con Ant
      - name: Build with Ant
        run: |
          ant -f build.xml  # Ejecuta la construcción según tu build.xml

      # Paso 5: Ejecutar el análisis de SonarCloud
      - name: Run SonarCloud Analysis
        run: ant sonar  # Ejecuta el target de SonarCloud definido en build.xml
